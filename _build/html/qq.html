
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>webqq3.0 协议分析 &mdash; webqq v1 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="webqq v1 documentation" href="index.html" />
    <link rel="next" title="Open Api 框架设计" href="framework.html" />
    <link rel="prev" title="Welcome to webqq’s documentation!" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="framework.html" title="Open Api 框架设计"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to webqq’s documentation!"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">webqq v1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="webqq3-0">
<h1>webqq3.0 协议分析<a class="headerlink" href="#webqq3-0" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id1">
<h2>生成密码<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>访问如下的url <strong>http://check.ptlogin2.qq.com/check?uin=qqnumber&amp;appid=1003903&amp;r=0.09714xxxx</strong> 得到如下信息</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">pt_checkVC</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;!B55&#39;</span><span class="p">,</span> <span class="s1">&#39;\x00\x00\x00\x00\xa6\xce\xef\xfe&#39;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple">
<li>当前用户是否需要使用验证码登陆</li>
<li>提取第二三个字段作为加密的salt</li>
</ol>
<p>生成密码的步骤如下:</p>
<ol class="arabic simple">
<li>得到uin 的字节数组</li>
<li>将密码md5 后转换为字节数组</li>
<li>组合密码的字节数组和uin 的字节数组，密码在前</li>
<li>将组合后的字节数组进行md5</li>
<li>将最后一次md5 的hexstr+vcode,在进行一次 md5</li>
</ol>
<p>qq 密码的计算方法如下</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">md5</span><span class="p">(</span><span class="n">md5</span><span class="p">((</span><span class="n">md5</span><span class="p">(</span><span class="s">&quot;1234567890&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span><span class="o">+</span><span class="n">uin</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;!B55&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="ndlogin">
<span id="id2"></span><h2>使用生成的密码二次登陆<a class="headerlink" href="#ndlogin" title="Permalink to this headline">¶</a></h2>
<p>使用上次生成的密码字符串拼接如下url,进行二次登陆:</p>
<p><strong>http://ptlogin2.qq.com/login?u=10897944&amp;p=07B8A85663FAB28A25CEFEC495AD15CB&amp;verifycode=!WD3&amp;webqq_type=10&amp;remember_uin=1&amp;login2qq=1&amp;aid=1003903&amp;u1=http%3A%2F%2Fwebqq.qq.com%2Floginproxy.html%3Flogin2qq%3D1%26webqq_type%3D10&amp;h=1&amp;ptredirect=0&amp;ptlang=2052&amp;from_ui=1&amp;pttype=1&amp;dumy=&amp;fp=loginerroralert&amp;action=1-20-8656&amp;mibao_css=m_webqq&amp;t=1&amp;g=1</strong></p>
<ol class="arabic simple">
<li>发送上面的请求后，从返回的cookie中获取 <cite>ptwebqq</cite> 参数, 保存起来</li>
<li>发送过来的cookie都要保存起来，后面在请求的时候发送给 webqq</li>
<li>组装二次登陆的 <a class="reference external" href="http://d.web2.qq.com/channel/login2">http://d.web2.qq.com/channel/login2</a>,里面用到了ptwebqq参数, 需要注意的是本次需要发送的是 <cite>POST</cite> 请求:</li>
</ol>
<p><strong>r=%7B%22status%22%3A%22online%22%2C%22ptwebqq%22%3A%2272541a7b79772b8f09f72261b30e82b27e7712f44fa76884231d47b4d2894dc3%22%2C%22passwd_sig%22%3A%22%22%2C%22clientid%22%3A%2232383579%22%2C%22psessionid%22%3Anull%7D&amp;clientid=32383579&amp;psessionid=null</strong></p>
<p>实际的内容其实是两个字段，如下</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="nf">clientid</span><span class="kt">:</span> <span class="n">xxxxxxx</span>

<span class="nf">psessionid</span><span class="kt">:</span> <span class="n">null</span>

<span class="nf">r</span><span class="kt">:</span> <span class="p">{</span><span class="s">&quot;status&quot;</span><span class="kt">:</span><span class="s">&quot;online&quot;</span><span class="p">,</span><span class="s">&quot;ptwebqq&quot;</span><span class="kt">:</span><span class="s">&quot;72541a7b79772b8f09f72261b30e82b27e7712f44fa76884231d47b4d2894dc3&quot;</span><span class="p">,</span><span class="s">&quot;passwd_sig&quot;</span><span class="kt">:</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="s">&quot;clientid&quot;</span><span class="kt">:</span><span class="s">&quot;32383579&quot;</span><span class="p">,</span><span class="s">&quot;psessionid&quot;</span><span class="kt">:</span><span class="n">null</span><span class="p">}</span>
</pre></div>
</div>
<p>对上面的内容进行urlencode 后发送到服务器</p>
<ol class="arabic simple" start="4">
<li>发送请求之前需要在请求中增加 http header Referer: <a class="reference external" href="http://d.web2.qq.com/proxy.html?v=20110331002&amp;callback=2">http://d.web2.qq.com/proxy.html?v=20110331002&amp;callback=2</a></li>
<li>从返回的json值中提取登陆的结果， 并把 <cite>psessionid</cite> 和 <cite>vfwebqq</cite> 保存起来，后面发送请求的时候要使用, 返回值如下</li>
</ol>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span><span class="s2">&quot;retcode&quot;</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;result&quot;</span><span class="o">:</span>
      <span class="p">{</span>
       <span class="s2">&quot;uin&quot;</span><span class="o">:</span><span class="mi">10897944</span><span class="p">,</span><span class="s2">&quot;cip&quot;</span><span class="o">:</span><span class="mi">1959559061</span><span class="p">,</span><span class="s2">&quot;index&quot;</span><span class="o">:</span><span class="mi">1075</span><span class="p">,</span><span class="s2">&quot;port&quot;</span><span class="o">:</span><span class="mi">40036</span><span class="p">,</span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="s2">&quot;online&quot;</span><span class="p">,</span>
       <span class="s2">&quot;vfwebqq&quot;</span><span class="o">:</span><span class="s2">&quot;963856c05954b2f1a0b1f4efff16cc605ce3a1b84792ac678dee4b919c1a&quot;</span><span class="p">,</span>
       <span class="s2">&quot;psessionid&quot;</span><span class="o">:</span><span class="s2">&quot;c53856c05954b2f1a0b1f4efff16cc605ce3a1b84792ac678dee4b919c1a&quot;</span><span class="p">,</span><span class="s2">&quot;user_state&quot;</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;f&quot;</span><span class="o">:</span><span class="mi">0</span>
      <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>获取朋友的列表<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>登陆成功后获取自己的朋友列表，需要组装下列 <strong>POST</strong> 请求发送到 <a class="reference external" href="http://s.web2.qq.com/api/get_user_friend2">http://s.web2.qq.com/api/get_user_friend2</a></p>
<p>需要设置 Referer 参数为 <a class="reference external" href="http://d.web2.qq.com/proxy.html?v=20110331002&amp;callback=2">http://d.web2.qq.com/proxy.html?v=20110331002&amp;callback=2</a></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">r</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;h&quot;</span><span class="o">:</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span><span class="s2">&quot;vfwebqq&quot;</span><span class="o">:</span><span class="s2">&quot;9635b7bdfb20a7d08f43c53856c05954b2f1a0b1f4efff16cc605ce3a1b84792ac678dee4b919c1a&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>需要使用将上面的参数编码后发送，</p>
<p><strong>r=%7B%22h%22%3A%22hello%22%2C%22vfwebqq%22%3A%229635b7bdfb20a7d08f43c53856c05954b2f1a0b1f4efff16cc605ce3a1b84792ac678dee4b919c1a%22%7D</strong></p>
<p>得到的返回值为json格式，基本结构如下</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span><span class="s2">&quot;retcode&quot;</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;marknames&quot;</span><span class="p">,[],</span> <span class="s2">&quot;info&quot;</span><span class="o">:</span><span class="p">[],</span> <span class="s2">&quot;vipinfo&quot;</span><span class="o">:</span><span class="p">[],</span> <span class="s2">&quot;categories&quot;</span><span class="o">:</span><span class="p">[]}}</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">参数的解释:</span></tt></p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="31%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">参数名称</th>
<th class="head">参数描述</th>
<th class="head">返回值结构</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>returncode</td>
<td>返回码，为 0 时表示成功</td>
<td>无</td>
</tr>
<tr><td>marknames</td>
<td>表示加了备注的好友,结构如下
{&#8216;markname&#8217;:&#8221;&#8220;, &#8220;uin&#8221;:}</td>
<td>{&#8220;markname&#8221;:&#8221;&#8220;, &#8220;uin&#8221;:&#8221;&#8220;}</td>
</tr>
<tr><td>info</td>
<td>存放所有好友和uin的对应关系</td>
<td>[{&#8220;nick&#8221;:&#8221;&#8220;, &#8220;flag&#8221;:&#8221;&#8220;,&#8221;uin&#8221;:&#8221;&#8220;,&#8221;face&#8221;:&#8221;&#8220;}]</td>
</tr>
<tr><td>vipinfo</td>
<td>存放所有好友的vip级别</td>
<td>不做描述</td>
</tr>
<tr><td>categories</td>
<td>好友和uin 的对应关系，用户
分组信息</td>
<td>{&#8220;sort&#8221;:1, &#8220;index&#8221;:1,&#8221;name&#8221;:&#8221;&#8220;}</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="receivemsg">
<span id="id4"></span><h2>接收消息<a class="headerlink" href="#receivemsg" title="Permalink to this headline">¶</a></h2>
<p>使用链接 <a class="reference external" href="http://d.web2.qq.com/channel/poll2">http://d.web2.qq.com/channel/poll2</a> 发送 <cite>POST</cite> 请求轮询好友发送的消息</p>
<p><strong>clientid</strong> 是一个long型的整数，一般写一个就行了，后面可以重复使用</p>
<p><strong>POST 过去的参数都必须先进行编码后发送</strong></p>
<p>必须设置http header <strong>Referer:http://d.web2.qq.com/proxy.html?v=20110331002&amp;callback=1&amp;id=3</strong> 这个值目前是固定的</p>
<p>轮询消息也不需要有cookies的支持</p>
<div class="highlight-haskell"><div class="highlight"><pre><span class="nf">clientid</span><span class="ow">=</span><span class="mi">32383579</span>
<span class="nf">psessionid</span><span class="ow">=</span><span class="mi">54</span><span class="n">b2f1a0b1f4efff16cc605ce3a1b84792ac678dee4b919c1a</span>
<span class="nf">r</span><span class="ow">=</span><span class="p">{</span><span class="s">&quot;clientid&quot;</span><span class="kt">:</span><span class="s">&quot;32383579&quot;</span><span class="p">,</span><span class="s">&quot;psessionid&quot;</span><span class="kt">:</span><span class="s">&quot;54b2f1a0b1f4efff16cc605ce3a1b84792ac678dee4b919c1a&quot;</span><span class="p">,</span><span class="s">&quot;key&quot;</span><span class="kt">:</span><span class="mi">0</span><span class="p">,</span><span class="s">&quot;ids&quot;</span><span class="kt">:[]</span><span class="p">}</span>
</pre></div>
</div>
<p>返回值为json格式</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span><span class="s2">&quot;retcode&quot;</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="p">[{</span><span class="s2">&quot;poll_type&quot;</span><span class="o">:</span><span class="s2">&quot;buddies_status_change&quot;</span><span class="p">,</span><span class="s2">&quot;value&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;uin&quot;</span><span class="o">:</span><span class="mi">3983012188</span><span class="p">,</span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="s2">&quot;online&quot;</span><span class="p">,</span><span class="s2">&quot;client_type&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">}}]}</span>
</pre></div>
</div>
<p>retcode 为 0 才可以获取后续的值， 具体的消息类型通过result字段的 <strong>poll_type</strong> 的值决定， <strong>poll_type</strong> 的可选值如下表:</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">poll_type</th>
<th class="head">描述</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>buddies_status_change</td>
<td>用户的在线状态发生改变</td>
</tr>
<tr><td>message</td>
<td>收到用户发送的消息</td>
</tr>
<tr><td>kick_message</td>
<td>同一个账号在另外的地方登陆,客户端收到后应该断开与服务器的连接</td>
</tr>
</tbody>
</table>
<p>result 是一个数组，所以里面可以包含多个不同 <strong>poll_type</strong> 的消息</p>
<p>buddies_status_change 消息的结构如下:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span><span class="s2">&quot;poll_type&quot;</span><span class="o">:</span><span class="s2">&quot;buddies_status_change&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="o">:</span><span class="p">{</span><span class="s2">&quot;uin&quot;</span><span class="o">:</span><span class="nx">xxxxxxx</span><span class="p">,</span><span class="s2">&quot;status&quot;</span><span class="o">:</span><span class="s2">&quot;online&quot;</span><span class="p">,</span><span class="s2">&quot;client_type&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">}}</span>
</pre></div>
</div>
<p>message 消息的结构如下:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span><span class="s1">&#39;poll_type&#39;</span><span class="o">:</span> <span class="s1">&#39;message&#39;</span><span class="p">,</span>
  <span class="s1">&#39;value&#39;</span><span class="o">:</span>
      <span class="p">{</span>
          <span class="s1">&#39;reply_ip&#39;</span><span class="o">:</span> <span class="mi">176498310</span><span class="p">,</span> <span class="s1">&#39;msg_type&#39;</span><span class="o">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;msg_id&#39;</span><span class="o">:</span> <span class="mi">10171</span><span class="p">,</span>
          <span class="s1">&#39;content&#39;</span><span class="o">:</span> <span class="p">[</span>
                       <span class="p">[</span>
                        <span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="o">:</span> <span class="s1">&#39;000000&#39;</span><span class="p">,</span> <span class="s1">&#39;style&#39;</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;name&#39;</span><span class="o">:</span> <span class="s1">&#39;\u5b8b\u4f53&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="o">:</span> <span class="mi">9</span><span class="p">}</span>
                       <span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;\u4e2d\u5348\u5462\r&#39;</span>
                     <span class="p">],</span>
           <span class="s1">&#39;msg_id2&#39;</span><span class="o">:</span> <span class="mi">158459</span><span class="p">,</span> <span class="s1">&#39;from_uin&#39;</span><span class="o">:</span> <span class="mi">3898449591</span><span class="nx">L</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="o">:</span> <span class="mi">1348566488</span><span class="p">,</span> <span class="s1">&#39;to_uin&#39;</span><span class="o">:</span> <span class="mi">10897944</span>
      <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>kick_message 消息的结构如下:</p>
<div class="highlight-javascript"><div class="highlight"><pre> <span class="p">{</span>
  <span class="s1">&#39;poll_type&#39;</span><span class="o">:</span> <span class="s1">&#39;kick_message&#39;</span><span class="p">,</span>
   <span class="s1">&#39;value&#39;</span><span class="o">:</span>
       <span class="p">{</span>
       <span class="s1">&#39;reply_ip&#39;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
       <span class="s1">&#39;msg_type&#39;</span><span class="o">:</span> <span class="mi">48</span><span class="p">,</span>
       <span class="s1">&#39;msg_id&#39;</span><span class="o">:</span> <span class="mi">30519</span><span class="p">,</span>
       <span class="s1">&#39;reason&#39;</span><span class="o">:</span> <span class="s1">&#39;xxxx for force logout&#39;</span><span class="p">,</span>
       <span class="s1">&#39;msg_id2&#39;</span><span class="o">:</span> <span class="mi">30520</span><span class="p">,</span>
       <span class="s1">&#39;from_uin&#39;</span><span class="o">:</span> <span class="mi">10000</span><span class="p">,</span>
       <span class="s1">&#39;show_reason&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
       <span class="s1">&#39;to_uin&#39;</span><span class="o">:</span> <span class="mi">10897944</span>
       <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h2>发送消息给好友<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>发送 <cite>POST</cite> 请求到链接 <a class="reference external" href="http://d.web2.qq.com/channel/send_buddy_msg2">http://d.web2.qq.com/channel/send_buddy_msg2</a> ，并提交以下内容到服务器即可, 需要注意的是发送的内容要进行 <tt class="docutils literal"><span class="pre">url编码</span></tt> 之后发送</p>
<p>发送消息时不需要cookie的支持，服务器只识别clientid和psessionid这两个参数</p>
<p>必须设置http header <strong>Referer:http://d.web2.qq.com/proxy.html?v=20110331002&amp;callback=1&amp;id=3</strong> 这个值目前是固定的</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">clientid</span><span class="o">=</span><span class="mi">44597165</span>
<span class="nx">psessionid</span><span class="o">=</span><span class="mi">8304</span><span class="nx">fbcd9008992d818c910636a81146633f3bdd6b8e0a53b910d59b40e521dd924fb9</span>
<span class="nx">r</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;to&quot;</span><span class="o">:</span><span class="mi">2481546577</span><span class="p">,</span>
  <span class="s2">&quot;face&quot;</span><span class="o">:</span><span class="mi">177</span><span class="p">,</span>
  <span class="s2">&quot;content&quot;</span><span class="o">:</span><span class="s2">&quot;[\&quot;好快，就到中午了\\n\&quot;,[\&quot;font\&quot;,{\&quot;name\&quot;:\&quot;宋体\&quot;,\&quot;size\&quot;:\&quot;10\&quot;,\&quot;style\&quot;:[0,0,0],\&quot;color\&quot;:\&quot;000000\&quot;}]]&quot;</span><span class="p">,</span>
  <span class="s2">&quot;msg_id&quot;</span><span class="o">:</span><span class="mi">85970004</span><span class="p">,</span>
  <span class="s2">&quot;clientid&quot;</span><span class="o">:</span><span class="s2">&quot;44597165&quot;</span><span class="p">,</span>
  <span class="s2">&quot;psessionid&quot;</span><span class="o">:</span><span class="s2">&quot;8304fbcd9008992d818c910636a81146633f3bdd6b8e0a53b910d59b40e521dd924fb9&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>clientid 的解释参考 <a class="reference internal" href="#receivemsg"><em>接收消息</em></a> 小节的解释</p>
<p>psessionid 是 <a class="reference internal" href="#ndlogin"><em>使用生成的密码二次登陆</em></a> 成功之后服务器返回的唯一参数，会话的过程中都要带上这个参数</p>
<p>content 的基础结构如下:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">[</span><span class="s2">&quot;msgbody&quot;</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;font&quot;</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span><span class="s2">&quot;宋体&quot;</span><span class="p">,</span> <span class="s2">&quot;size&quot;</span><span class="o">:</span><span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="s2">&quot;style&quot;</span><span class="o">:</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;color&quot;</span><span class="o">:</span><span class="s2">&quot;000000&quot;</span><span class="p">}</span>
    <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>r 参数的详细解释如下表:</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">参数名称</th>
<th class="head">参数描述</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>to</td>
<td>发送消息给朋友，uin 在这里
不是指朋友的qq号码,每次不同</td>
</tr>
<tr><td>face</td>
<td>可能是表情的编号，具体意思未知</td>
</tr>
<tr><td>content</td>
<td>发送给朋友的消息和格式描述</td>
</tr>
<tr><td>clientid</td>
<td>参考 <a class="reference internal" href="#receivemsg"><em>接收消息</em></a></td>
</tr>
<tr><td>psessionid</td>
<td>参考 <a class="reference internal" href="#ndlogin"><em>使用生成的密码二次登陆</em></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id6">
<h2>发送群消息<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id7">
<h2>获取好友的详细信息<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="id8">
<h2>心跳维护<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>周期性的发送 <cite>GET</cite> 请求到 url <a class="reference external" href="http://webqq.qq.com/web2/get_msg_tip?uin=&amp;tp=1&amp;id=0&amp;retype=1&amp;rc=1&amp;lv=3&amp;t=1348458711542">http://webqq.qq.com/web2/get_msg_tip?uin=&amp;tp=1&amp;id=0&amp;retype=1&amp;rc=1&amp;lv=3&amp;t=1348458711542</a> 维持与qq服务器的连接</p>
</div>
<div class="section" id="id9">
<h2>改变登陆状态<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<p>发送 <cite>GET</cite> 请求到 url <a class="reference external" href="http://d.web2.qq.com/channel/change_status2?newstatus=hidden&amp;clientid=44597165&amp;psessionid=aac22e218a25034e1e1d9ed142c52168005f5983&amp;t=1348482231366">http://d.web2.qq.com/channel/change_status2?newstatus=hidden&amp;clientid=44597165&amp;psessionid=aac22e218a25034e1e1d9ed142c52168005f5983&amp;t=1348482231366</a></p>
<p>这个也不需要cookie的支持，但是clientid和psessionid要正确填写</p>
<p>参数解释:</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">参数名称</th>
<th class="head">参数描述</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>newstatus</td>
<td><blockquote class="first">
要改变的状态，可选值：</blockquote>
<p class="last">1. hidden 2. online 3. away
4. busy 5. offline</p>
</td>
</tr>
<tr><td>clientid</td>
<td>参考 <a class="reference internal" href="#receivemsg"><em>接收消息</em></a></td>
</tr>
<tr><td>psessionid</td>
<td>参考 <a class="reference internal" href="#ndlogin"><em>使用生成的密码二次登陆</em></a></td>
</tr>
<tr><td>t</td>
<td>基于时间的随机数</td>
</tr>
</tbody>
</table>
<p>返回的是 json 格式数据</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="p">{</span><span class="s2">&quot;retcode&quot;</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;result&quot;</span><span class="o">:</span><span class="s2">&quot;ok&quot;</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="webqq">
<h2>webqq返回码解释<a class="headerlink" href="#webqq" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">返回码</th>
<th class="head">意义</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>102</td>
<td>轮询消息超时</td>
</tr>
<tr><td>0</td>
<td>成功</td>
</tr>
<tr><td>116</td>
<td>通知更新ptwebqq的值</td>
</tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">webqq3.0 协议分析</a><ul>
<li><a class="reference internal" href="#id1">生成密码</a></li>
<li><a class="reference internal" href="#ndlogin">使用生成的密码二次登陆</a></li>
<li><a class="reference internal" href="#id3">获取朋友的列表</a></li>
<li><a class="reference internal" href="#receivemsg">接收消息</a></li>
<li><a class="reference internal" href="#id5">发送消息给好友</a></li>
<li><a class="reference internal" href="#id6">发送群消息</a></li>
<li><a class="reference internal" href="#id7">获取好友的详细信息</a></li>
<li><a class="reference internal" href="#id8">心跳维护</a></li>
<li><a class="reference internal" href="#id9">改变登陆状态</a></li>
<li><a class="reference internal" href="#webqq">webqq返回码解释</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Welcome to webqq&#8217;s documentation!</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="framework.html"
                        title="next chapter">Open Api 框架设计</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/qq.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="framework.html" title="Open Api 框架设计"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Welcome to webqq’s documentation!"
             >previous</a> |</li>
        <li><a href="index.html">webqq v1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, alex8224@gmail.com.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.1.
    </div>
  </body>
</html>